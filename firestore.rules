
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // मदतनीस कार्य (Helper function)
    function isSignedIn() {
      return request.auth != null;
    }

    // १. कलेक्शन ग्रुप नियम (Collection Group Rules)
    // हे नियम मार्केटप्लेस, डॅशबोर्ड आणि मास्टर डेटा व्ह्यूसाठी अत्यंत आवश्यक आहेत
    
    // सर्व 'profile' सब-कलेक्शन्ससाठी परवानग्या
    match /{path=**}/profile/{profileId} {
      allow read, list: if isSignedIn();
    }
    
    // सर्व 'cropCycles' सब-कलेक्शन्ससाठी परवानग्या
    match /{path=**}/cropCycles/{cropId} {
      allow read, list: if isSignedIn();
    }

    // २. डॉक्युमेंट स्तरावरील नियम (Document Level Rules)
    
    // युजर्सचे फोल्डर
    match /users/{userId} {
      allow read, list: if isSignedIn();
      allow write: if isSignedIn() && request.auth.uid == userId;

      // युजरच्या अंतर्गत असलेली सर्व कलेक्शन्स (profile, cropCycles)
      match /{allSubPaths=**} {
        allow read, list: if isSignedIn();
        allow write: if isSignedIn() && request.auth.uid == userId;
      }
    }

    // खरेदी (Transactions) - सर्व लॉगिन युजर्सना खरेदी करण्याची परवानगी
    match /transactions/{txnId} {
      allow read, list: if isSignedIn();
      allow write: if isSignedIn();
    }

    // सार्वजनिक माहिती (उदा. बातम्या किंवा प्रश्न)
    match /questions/{questionId} {
      allow read, list: if true;
      allow write: if isSignedIn();
    }
    
    match /communityContent/{contentId} {
      allow read, list: if true;
    }
  }
}
