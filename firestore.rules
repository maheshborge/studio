
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // मदतनीस कार्य (Helper function)
    function isSignedIn() {
      return request.auth != null;
    }

    // १. सर्वसाधारण नियम: लॉगिन केलेल्या युजर्सना सर्व डेटा वाचण्याची परवानगी
    // यामुळे डॅशबोर्ड, मार्केटप्लेस आणि डेटा व्ह्यूमधील 'Permissions' एरर दूर होईल
    match /{document=**} {
      allow read, list: if isSignedIn();
    }

    // २. कलेक्शन ग्रुप (Collection Group) नियम - अत्यंत महत्त्वाचे
    // डॅशबोर्डवर सर्व पिकांची आणि प्रोफाईल्सची माहिती एकत्रित पाहण्यासाठी हे आवश्यक आहे
    match /{path=**}/profile/{profileDoc} {
      allow read, list: if isSignedIn();
    }
    
    match /{path=**}/cropCycles/{cropId} {
      allow read, list: if isSignedIn();
    }

    // ३. युजर प्रोफाईल आणि पिके: फक्त स्वतःचा डेटा बदलण्याची परवानगी
    match /users/{userId}/{allSubPaths=**} {
      allow write: if isSignedIn() && request.auth.uid == userId;
    }

    // ४. खरेदी (Transactions): सर्व लॉगिन युजर्सना खरेदी करण्याची परवानगी
    match /transactions/{txnId} {
      allow read, list, write: if isSignedIn();
    }

    // ५. सार्वजनिक माहिती (उदा. बातम्या किंवा प्रश्न)
    match /questions/{questionId} {
      allow read, list: if true;
      allow write: if isSignedIn();
    }
    
    match /communityContent/{contentId} {
      allow read, list: if true;
    }
  }
}
